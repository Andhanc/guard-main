version: "3.9"

services:
  app:
    build: .
    container_name: plagiarismguard-app
    restart: unless-stopped
    environment:
      NODE_ENV: production
      PORT: 3000
      NEXT_TELEMETRY_DISABLED: "1"
      # LDAP переменные (можно переопределить через .env файл или docker-compose.override.yml)
      # LDAP_ENABLED: "false"
      # LDAP_URL: "ldaps://ldap.bsuir.by"
      # LDAP_BASE_DN: "dc=bsuir,dc=by"
      # LDAP_BIND_DN: "uid=smdoadmin,ou=staff,dc=bsuir,dc=by"
      # LDAP_BIND_PASSWORD: "your_password"
      # LDAP_USER_SEARCH_BASES: "ou=staff,dc=bsuir,dc=by,ou=stud,dc=bsuir,dc=by"
      # LDAP_USER_SEARCH_FILTER: "(uid={username})"
      # LDAP_USERNAME_ATTRIBUTE: "uid"
      # LDAP_EMAIL_ATTRIBUTE: "mail"
      # LDAP_FIRSTNAME_ATTRIBUTE: "givenName"
      # LDAP_LASTNAME_ATTRIBUTE: "sn"
      # LDAP_TIMEOUT: "10000"
    env_file:
      - .env.local  # Загружает переменные из .env.local (если существует)
    volumes:
      # Персистентное хранилище для загружаемых файлов, документов и логов
      - ./data:/app/data
    networks:
      - plagiarismguard-network

  nginx:
    image: nginx:alpine
    container_name: plagiarismguard-nginx
    restart: unless-stopped
    depends_on:
      - app
    ports:
      - "3000:3000"  # Порт для доступа через guard-main.by:3000
      - "443:443"  # Для HTTPS (если настроен SSL)
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      # Для SSL сертификатов (раскомментируйте при необходимости)
      # - ./ssl:/etc/nginx/ssl:ro
    networks:
      - plagiarismguard-network

networks:
  plagiarismguard-network:
    driver: bridge



